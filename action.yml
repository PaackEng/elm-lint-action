name: "Elm Validate"
description: "Runs Elm through elm-format and elm-review then compiles it"

elm-package:
  description: "Is this a package instead of an app?"
  required: false
  default: false
elm-working-directory:
  description: "Working directory of lint, review and compile steps"
  required: false
  default: "."
extra-path:
  description: "Extra paths to be linted"
  required: false

runs:
  using: "composite"
  steps:
    - name: Install dependencies
      run: yarn install

    - name: Run linter
      working-directory: ${{ inputs.elm-working-directory }}
      run: npx elm-format --validate src ${{ inputs.extra-path }}

    - name: Run elm-review
      working-directory: ${{ inputs.elm-working-directory }}
      run: npx elm-review --template PaackEng/elm-review-config src ${{ inputs.extra-path }}

    - name: Validate code (app)
      working-directory: ${{ inputs.elm-working-directory }}
      run: npx elm make src/Main.elm --output /dev/null
      if: inputs.elm-package == false

    - name: Validate code (package)
      working-directory: ${{ inputs.elm-working-directory }}
      run: npx elm make
      if: inputs.elm-package == true
